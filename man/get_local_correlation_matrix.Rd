% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/local_correlation_matrix.R
\name{get_local_correlation_matrix}
\alias{get_local_correlation_matrix}
\title{Local (kernel-wise) Fisher correlations for all gene pairs}
\usage{
get_local_correlation_matrix(
  expr,
  weight_matrix,
  fisher_transform = TRUE,
  drop_zero_weight = TRUE
)
}
\arguments{
\item{expr}{Numeric matrix (rows = points/cells, cols = genes).}

\item{weight_matrix}{Point×kernel weight matrix (preferably
\code{Matrix::dgCMatrix}) with \code{nrow(weight_matrix) == nrow(expr)}.}

\item{fisher_transform}{Logical; if \code{TRUE} (default), return Fisher-\eqn{z}
values; otherwise return raw correlations.}

\item{drop_zero_weight}{Logical; if \code{TRUE} (default), restrict each kernel's
calculation to rows with strictly positive weight for that kernel.}
}
\value{
A numeric matrix with \code{nrow = ncol(weight_matrix)} (kernels) and
\code{ncol = choose(p, 2)} (gene pairs, where \code{p = ncol(expr)}).
Row names are kernel names; column names are \code{"GENE1_GENE2"}.
Entries are Fisher-\eqn{z} if \code{fisher_transform=TRUE}, else raw \eqn{\hat{r}}.
}
\description{
For every unordered gene pair in \code{expr}, compute a vector of
weighted Pearson correlations \eqn{\hat{r}}—one per kernel—using \code{weight_matrix}.
By default the correlations are Fisher-transformed (\eqn{z = \mathrm{atanh}(\hat{r})}).
Columns are labeled as \code{"GENE1_GENE2"}.
}
\examples{
set.seed(1)
expr <- cbind(g1 = rnorm(60), g2 = rnorm(60), g3 = rnorm(60))
coords <- cbind(runif(60), runif(60))
centres <- generate_kernel_centres_by_density(coords, span = 0.2)
W <- generate_weight_matrix_euclidean(coords, centres, span = 0.2, type = "gaussian")
Zmat <- get_local_correlation_matrix(expr, W)
dim(Zmat)   # kernels x choose(3,2) = kernels x 3

}
\seealso{
\code{\link{get_local_correlation_vector_pair}}
}
