% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sigma_matrix.R
\name{get_sigma_matrix}
\alias{get_sigma_matrix}
\title{Covariance matrix of kernel-wise Fisher z coefficients}
\usage{
get_sigma_matrix(corr, neff)
}
\arguments{
\item{corr}{A symmetric \eqn{n \times n} correlation matrix between kernels
(e.g., from \code{approximate_between_coefficient_correlations_effective(W)}).
Preferably a \code{Matrix} object; a base matrix is also accepted.
\strong{Pass the unattenuated correlation} (call with \code{neff = NULL}) so you
don't double-apply any scaling.}

\item{neff}{Numeric vector of length \eqn{n} with effective sample sizes per
kernel (e.g., from \code{get_effective_sample_sizes(W)}).}
}
\value{
A \code{Matrix} object of size \eqn{n \times n} with row/column names
taken from \code{corr}. Entries corresponding to kernels with
\eqn{n_{\mathrm{eff}} \leq 3} are returned as \code{NA_real_}.
}
\description{
Given a kernelâ€“kernel correlation matrix \code{corr} (for the Fisher
coefficients) and effective sample sizes \code{neff}, returns the covariance
matrix \eqn{\boldsymbol{\Sigma} = \boldsymbol{D}\,\mathrm{corr}\,\boldsymbol{D}}
where \eqn{\boldsymbol{D}=\mathrm{diag}(\sqrt{\boldsymbol{v}})}
and \eqn{v_k = 1/(n_{\mathrm{eff},k}-3)} (variance of Fisher z for a correlation).
}
\details{
For kernels with \eqn{n_{\mathrm{eff}} \leq 3}, the Fisher z variance is undefined.
In that case, we set the corresponding diagonal multiplier to zero while
forming \eqn{\boldsymbol{D}\,\mathrm{corr}\,\boldsymbol{D}}, and then mark the affected rows/columns of
\eqn{\boldsymbol{\Sigma}} as \code{NA}.
}
\examples{
set.seed(1)
coords  <- cbind(runif(60), runif(60))
centres <- generate_kernel_centres_by_density(coords, span = 0.2)
W       <- generate_weight_matrix_euclidean(coords, centres, span = 0.2, type = "gaussian")
neff    <- get_effective_sample_sizes(W)
corr    <- approximate_between_coefficient_correlations_effective(W)  # unattenuated
Sigma   <- get_sigma_matrix(corr, neff)
Matrix::diag(Sigma)[1:5]

}
