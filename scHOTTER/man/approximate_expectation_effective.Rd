% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/expectation_of_sample_variance.R
\name{approximate_expectation_effective}
\alias{approximate_expectation_effective}
\title{Expectation of the sample variance of Fisher z's under dependence}
\usage{
approximate_expectation_effective(sigma_matrix)
}
\arguments{
\item{sigma_matrix}{A symmetric \eqn{n\times n} covariance matrix for the
kernel-wise Fisher z coefficients (e.g., from \code{get_sigma_matrix()}).
May be a base matrix or a \pkg{Matrix} object. Rows/columns containing
\code{NA}s are dropped prior to computation.}
}
\value{
A single numeric: \eqn{\mathbb{E}[S^2]}. Returns \code{NA_real_}
if, after dropping \code{NA} rows/cols, fewer than 2 kernels remain.
}
\description{
Computes \eqn{\mathbb{E}[S^2]} for the unbiased sample variance
\eqn{S^2 = \frac{1}{n-1}\sum_{i=1}^n (Z_i - \bar{\boldsymbol{Z}})^2} when the
kernel-wise Fisher z vector \eqn{\boldsymbol{Z}} has covariance matrix
\eqn{\boldsymbol{\Sigma}}. The formula used is
\deqn{
\mathbb{E}[S^2]=\frac{1}{n-1}\left(
\mathrm{tr}(\boldsymbol{H} \boldsymbol{\Sigma})
\right), \quad
\boldsymbol{H} = \boldsymbol{I}_{n} -
\frac{1}{n}\boldsymbol{1}\boldsymbol{1}^{\top}
}
where \eqn{\boldsymbol{H}} is the centreing matrix.
For independent components with common variance \eqn{\sigma^2}, this reduces
to \eqn{\mathbb{E}[S^2]=\sigma^2}.
}
\examples{
# Sanity check: independent equal-variance case
n <- 8; v <- 0.2
Sigma <- diag(rep(v, n))
approximate_expectation_effective(Sigma)  # = v

}
